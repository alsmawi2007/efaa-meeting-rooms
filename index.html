<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مجمع الأمير سلطان للتأهيل - نظام حجز القاعات</title>

    <link rel="stylesheet" href="styles.css" />

    <!-- تحميل إعدادات Supabase -->
    <script src="config.js"></script>

    <!-- مكتبة Supabase -->
    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js";

        const SUPABASE_URL = window.APP_CONFIG.SUPABASE_URL;
        const SUPABASE_ANON = window.APP_CONFIG.SUPABASE_ANON_KEY;

        // إنشاء Supabase Client
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

        console.log("Supabase loaded:", SUPABASE_URL);
        window.supabase = supabase; // تخزينه للاستخدام
    </script>

</head>

<body>

    <!-- المحتوى الرئيسي -->
    <div id="app">
        <h2>مجمع الأمير سلطان للتأهيل - إيفاء</h2>
        <h4>نظام حجز قاعات الاجتماعات الداخلية</h4>

        <div class="section">
            <h3>القاعات المتاحة</h3>
            <div id="roomsGrid"></div>
            <p id="roomsHint" class="hint"></p>
        </div>

        <div class="section">
            <h3>حجوزات اليوم للقاعات</h3>
            <input type="date" id="datePicker" />
            <div id="bookingList"></div>
            <p id="bookingEmpty" class="hint"></p>
        </div>
    </div>

    <!-- سكربت التشغيل -->
    <script type="module">
        // التأكد من وجود supabase
        const supabase = window.supabase;

        const roomsGrid = document.getElementById("roomsGrid");
        const roomsHint = document.getElementById("roomsHint");
        const bookingList = document.getElementById("bookingList");
        const bookingEmpty = document.getElementById("bookingEmpty");
        const datePicker = document.getElementById("datePicker");

        // تحميل القاعات
        async function loadRooms() {
            const { data, error } = await supabase.from("rooms").select("*");

            if (error) {
                roomsHint.textContent = "تعذر تحميل القاعات.";
                return;
            }

            if (!data.length) {
                roomsHint.textContent = "لا توجد قاعات مسجلة.";
                return;
            }

            roomsGrid.innerHTML = data
                .map(room => `<div class="room-box">${room.name}</div>`)
                .join("");
        }

        // تحميل الحجوزات
        async function loadBookings(date) {
            const { data, error } = await supabase
                .from("bookings")
                .select("*")
                .eq("date", date);

            if (error) {
                bookingEmpty.textContent = "حدث خطأ أثناء تحميل الحجوزات.";
                return;
            }

            if (!data.length) {
                bookingEmpty.textContent = "لا توجد حجوزات لهذا اليوم.";
                bookingList.innerHTML = "";
                return;
            }

            bookingList.innerHTML = data
                .map(b => `<div class="booking-item">قاعة: ${b.room_name} — من ${b.start_time} إلى ${b.end_time}</div>`)
                .join("");
        }

        // عند اختيار التاريخ
        datePicker.addEventListener("change", (e) => {
            loadBookings(e.target.value);
        });

        // بداية التشغيل
        loadRooms();
    </script>

</body>
</html>
